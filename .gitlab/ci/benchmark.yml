# Benchmark jobs

benchmark:
  stage: benchmark
  image: rust:latest
  script:
    - cargo install cargo-criterion || true
    - cargo bench --all-features
    - mkdir -p public/benchmarks
    - cp -r target/criterion/* public/benchmarks/ || true
  artifacts:
    paths:
      - public/benchmarks
    expire_in: 30 days
  only:
    - main
    - merge_requests

benchmark:compare:
  stage: benchmark
  image: rust:latest
  script:
    - cargo bench --all-features -- --save-baseline current
  artifacts:
    paths:
      - target/criterion
    expire_in: 7 days
  only:
    - merge_requests
