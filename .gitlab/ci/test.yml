# Test jobs

.test_template: &test_template
  stage: test
  before_script:
    - rustc --version
    - cargo --version
  cache:
    paths:
      - .cargo/
      - target/

test:stable:
  <<: *test_template
  image: rust:latest
  script:
    - cargo test --all-features
    - cargo test --no-default-features

test:1.70:
  <<: *test_template
  image: rust:1.70
  script:
    - cargo test --all-features

test:nightly:
  <<: *test_template
  image: rustlang/rust:nightly
  script:
    - cargo test --all-features
  allow_failure: true

test:doc:
  <<: *test_template
  image: rust:latest
  script:
    - cargo test --doc --all-features

test:miri:
  <<: *test_template
  image: rustlang/rust:nightly
  script:
    - rustup component add miri
    - cargo miri setup
    - cargo miri test --tests
  allow_failure: true

test:no_std:
  <<: *test_template
  image: rust:latest
  script:
    - cargo build --no-default-features
    - cargo test --no-default-features

test:features:
  <<: *test_template
  image: rust:latest
  script:
    - cargo test --features stats
    - cargo test --features serde
    - cargo test --features parking_lot
    - cargo test --features tracing
